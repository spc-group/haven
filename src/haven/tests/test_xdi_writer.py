from collections import ChainMap
import datetime as dt
import logging
import os
import time
from io import StringIO
from pathlib import Path
from unittest import TestCase, expectedFailure

import numpy as np
import pytest

# from freezegun import freeze_time
import pytz
import time_machine
from bluesky import RunEngine, plans as bp
from numpy import asarray as array
from ophyd.sim import SynAxis, SynGauss, motor

from haven import XDIWriter, energy_scan, exceptions

fake_time = pytz.timezone("America/New_York").localize(
    dt.datetime(2022, 8, 19, 19, 10, 51)
)


log = logging.getLogger(__name__)
# logging.basicConfig(level=logging.DEBUG)


# Stub the epics signals in Haven

THIS_DIR = Path(__file__).parent


# Sample metadata dict
{
    "E0": 0,
    "beamline": {
        "is_connected": False,
        "name": "SPC Beamline (sector unknown)",
        "pv_prefix": "",
    },
    "detectors": ["I0", "It"],
    "edge": "Ni_K",
    "facility": {"name": "Advanced Photon Source", "xray_source": "insertion device"},
    "hints": {"dimensions": [(["energy", "exposure"], "primary")]},
    "ion_chambers": {"scaler": {"pv_prefix": ""}},
    "motors": ["energy", "exposure"],
    "num_intervals": 9,
    "num_points": 10,
    "plan_args": {
        "args": [
            (
                "SynAxis(prefix='', name='energy', "
                "read_attrs=['readback', 'setpoint'], "
                "configuration_attrs=['velocity', 'acceleration'])"
            ),
            array([8300, 8310, 8320, 8330, 8340, 8350, 8360, 8370, 8380, 8390]),
            (
                "SynAxis(prefix='', name='exposure', "
                "read_attrs=['readback', 'setpoint'], "
                "configuration_attrs=['velocity', 'acceleration'])"
            ),
            [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
        ],
        "detectors": [
            (
                "SynGauss(prefix='', name='I0', "
                "read_attrs=['val'], configuration_attrs=['Imax', "
                "'center', 'sigma', 'noise', 'noise_multiplier'])"
            ),
            (
                "SynGauss(prefix='', name='It', "
                "read_attrs=['val'], configuration_attrs=['Imax', "
                "'center', 'sigma', 'noise', "
                "'noise_multiplier'])"
            ),
        ],
        "per_step": "None",
    },
    "plan_name": "list_scan",
    "plan_pattern": "inner_list_product",
    "plan_pattern_args": {
        "args": [
            (
                "SynAxis(prefix='', name='energy', "
                "read_attrs=['readback', 'setpoint'], "
                "configuration_attrs=['velocity', "
                "'acceleration'])"
            ),
            array([8300, 8310, 8320, 8330, 8340, 8350, 8360, 8370, 8380, 8390]),
            (
                "SynAxis(prefix='', name='exposure', "
                "read_attrs=['readback', 'setpoint'], "
                "configuration_attrs=['velocity', "
                "'acceleration'])"
            ),
            [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
        ]
    },
    "plan_pattern_module": "bluesky.plan_patterns",
    "plan_type": "generator",
    "sample_name": "NiO_rock_salt",
    "scan_id": 1,
    "time": 1661025010.409619,
    "uid": "671c3c48-f014-421d-b3e0-57991b6745f6",
    "versions": {"bluesky": "1.8.3", "ophyd": "1.6.4"},
}


start_doc = {
    "versions": {"bluesky": "1.8.3", "ophyd": "1.6.4"},
    "detectors": ["I0", "It"],
    "motors": ["energy", "exposure"],
    "edge": "Ni_K",
    "facility": {
        "name": "Advanced Photon Source",
        "xray_source": "insertion device",
    },
    "beamline": {"name": "20-ID-C", "pv_prefix": "20id:"},
    "sample_name": "nickel oxide",
    "uid": "671c3c48-f014-421d-b3e0-57991b6745f6",
}
event_doc = {
    "data": {"I0": 2, "It": 1.5, "energy": 8330, "exposure": 0.1},
    "time": 1660186828.0055554,
}
descriptor_doc = {
    "configuration": {
        "I0": {
            "data": {
                "I0_channel_advance_source": 1,
                "I0_channel_one_source": 1,
                "I0_count_on_start": 1,
                "I0_description": "I0",
                "I0_frequency": 10000000.0,
                "I0_gate": 0,
                "I0_max_channels": 8000,
                "I0_num_channels_to_use": 8000,
                "I0_offset": 0.0,
                "I0_preset_count": 0.0,
                "I0_record_dark_time": 0.0,
                "I0_voltmeter_alarm_severity": 0,
                "I0_voltmeter_alarm_status": 0,
                "I0_voltmeter_description": "I0",
                "I0_voltmeter_device_type": 8,
                "I0_voltmeter_differential": 0,
                "I0_voltmeter_disable_alarm_severity": 0,
                "I0_voltmeter_disable_value": 1,
                "I0_voltmeter_forward_link": "",
                "I0_voltmeter_high": 0.0,
                "I0_voltmeter_input_link": "@asyn(LJT7V_0 " "2)ANALOG_IN_VALUE",
                "I0_voltmeter_low": 0.0,
                "I0_voltmeter_mode": 0,
                "I0_voltmeter_new_alarm_severity": 0,
                "I0_voltmeter_new_alarm_status": 0,
                "I0_voltmeter_range": 0,
                "I0_voltmeter_raw_value": 0,
                "I0_voltmeter_resolution": 0,
                "I0_voltmeter_scan_disable_input_link_value": 0,
                "I0_voltmeter_scan_disable_value_input_link": "",
                "I0_voltmeter_scanning_rate": 9,
                "I0_voltmeter_temperature_units": 0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "I0_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.NM4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.DESC",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_scanning_rate",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Passive",
                                "Event",
                                "I/O Intr",
                                "10 second",
                                "5 second",
                                "2 second",
                                "1 second",
                                ".5 second",
                                ".2 second",
                                ".1 " "second",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.SCAN",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_disable_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.DISV",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "I0_voltmeter_scan_disable_input_link_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.DISA",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "I0_voltmeter_scan_disable_value_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.SDIS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_forward_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.FLNK",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_device_type",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Soft " "Channel",
                                "Raw Soft " "Channel",
                                "Async " "Soft " "Channel",
                                "Soft " "Timestamp",
                                "General " "Time",
                                "asynInt32",
                                "asynInt32Average",
                                "asynFloat64",
                                "asynFloat64Average",
                                "asynInt64",
                                "IOC stats",
                                "IOC stats " "clusts",
                                "GPIB " "init/report",
                                "Sec Past " "Epoch",
                                "asyn ai " "stringParm",
                                "asyn ai " "HeidND261",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.DTYP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.STAT",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.SEVR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_new_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.NSTA",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_new_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.NSEV",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_disable_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.DISS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.INP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_raw_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -2147483648,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.RVAL",
                            "units": "",
                            "upper_ctrl_limit": 2147483647,
                        },
                    ),
                    (
                        "I0_voltmeter_differential",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Single-Ended", "Differential"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiDiff2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_high",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiHOPR2",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_voltmeter_low",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiLOPR2",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_voltmeter_temperature_units",
                        {
                            "dtype": "integer",
                            "enum_strs": ("K", "C", "F"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiTempUnits2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_resolution",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Default",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiResolution2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_range",
                        {
                            "dtype": "integer",
                            "enum_strs": ("+= 10V", "+= 1V", "+= 0.1V", "+= 0.01V"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiRange2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_voltmeter_mode",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Volts",
                                "Type B TC",
                                "Type C TC",
                                "Type E TC",
                                "Type J TC",
                                "Type K TC",
                                "Type N TC",
                                "Type R TC",
                                "Type S TC",
                                "Type T " "TC",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiMode2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_gate",
                        {
                            "dtype": "integer",
                            "enum_strs": ("N", "Y"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.G4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_preset_count",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.PR4",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_frequency",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 3,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.FREQ",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset0.D",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_record_dark_time",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset_time.VAL",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "I0_channel_advance_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Internal", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:ChannelAdvance",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_num_channels_to_use",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:NuseAll",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "I0_max_channels",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:MaxChannels",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "I0_channel_one_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Int. " "clock", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:Channel1Source",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "I0_count_on_start",
                        {
                            "dtype": "integer",
                            "enum_strs": ("No", "Yes"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:CountOnStart",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "I0_channel_advance_source": 1706288136.019154,
                "I0_channel_one_source": 1706288136.019154,
                "I0_count_on_start": 1712612472.005776,
                "I0_description": 1712864329.37917,
                "I0_frequency": 1712864329.37917,
                "I0_gate": 1712864329.37917,
                "I0_max_channels": 1706288136.002487,
                "I0_num_channels_to_use": 1706288136.002487,
                "I0_offset": 631152000.0,
                "I0_preset_count": 1712864329.37917,
                "I0_record_dark_time": 631152000.0,
                "I0_voltmeter_alarm_severity": 1712864344.408022,
                "I0_voltmeter_alarm_status": 1712864344.408022,
                "I0_voltmeter_description": 1712864344.808036,
                "I0_voltmeter_device_type": 1712864344.408022,
                "I0_voltmeter_differential": 1712864344.8890584,
                "I0_voltmeter_disable_alarm_severity": 1712864344.408022,
                "I0_voltmeter_disable_value": 1712864344.408022,
                "I0_voltmeter_forward_link": 1712864344.808036,
                "I0_voltmeter_high": 631152000.0,
                "I0_voltmeter_input_link": 1712864344.808036,
                "I0_voltmeter_low": 631152000.0,
                "I0_voltmeter_mode": 1712611706.863598,
                "I0_voltmeter_new_alarm_severity": 1712864344.408022,
                "I0_voltmeter_new_alarm_status": 1712864344.408022,
                "I0_voltmeter_range": 1712611706.864026,
                "I0_voltmeter_raw_value": 1712864344.408022,
                "I0_voltmeter_resolution": 1712611706.864253,
                "I0_voltmeter_scan_disable_input_link_value": 1712864344.408022,
                "I0_voltmeter_scan_disable_value_input_link": 1712864344.808036,
                "I0_voltmeter_scanning_rate": 1712864344.408022,
                "I0_voltmeter_temperature_units": 1712611706.863598,
            },
        },
        "IpreKB": {
            "data": {
                "IpreKB_channel_advance_source": 1,
                "IpreKB_channel_one_source": 1,
                "IpreKB_count_on_start": 1,
                "IpreKB_description": "IpreKB",
                "IpreKB_frequency": 10000000.0,
                "IpreKB_gate": 0,
                "IpreKB_max_channels": 8000,
                "IpreKB_num_channels_to_use": 8000,
                "IpreKB_offset": 0.0,
                "IpreKB_preset_count": 0.0,
                "IpreKB_record_dark_time": 0.0,
                "IpreKB_voltmeter_alarm_severity": 0,
                "IpreKB_voltmeter_alarm_status": 0,
                "IpreKB_voltmeter_description": "IpreKB",
                "IpreKB_voltmeter_device_type": 8,
                "IpreKB_voltmeter_differential": 0,
                "IpreKB_voltmeter_disable_alarm_severity": 0,
                "IpreKB_voltmeter_disable_value": 1,
                "IpreKB_voltmeter_forward_link": "",
                "IpreKB_voltmeter_high": 0.0,
                "IpreKB_voltmeter_input_link": "@asyn(LJT7V_0 " "1)ANALOG_IN_VALUE",
                "IpreKB_voltmeter_low": 0.0,
                "IpreKB_voltmeter_mode": 0,
                "IpreKB_voltmeter_new_alarm_severity": 0,
                "IpreKB_voltmeter_new_alarm_status": 0,
                "IpreKB_voltmeter_range": 0,
                "IpreKB_voltmeter_raw_value": 0,
                "IpreKB_voltmeter_resolution": 0,
                "IpreKB_voltmeter_scan_disable_input_link_value": 0,
                "IpreKB_voltmeter_scan_disable_value_input_link": "",
                "IpreKB_voltmeter_scanning_rate": 9,
                "IpreKB_voltmeter_temperature_units": 0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "IpreKB_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.NM3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.DESC",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_scanning_rate",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Passive",
                                "Event",
                                "I/O " "Intr",
                                "10 " "second",
                                "5 " "second",
                                "2 " "second",
                                "1 " "second",
                                ".5 " "second",
                                ".2 " "second",
                                ".1 " "second",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.SCAN",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_disable_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.DISV",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_scan_disable_input_link_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.DISA",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_scan_disable_value_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.SDIS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_forward_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.FLNK",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_device_type",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Soft " "Channel",
                                "Raw " "Soft " "Channel",
                                "Async " "Soft " "Channel",
                                "Soft " "Timestamp",
                                "General " "Time",
                                "asynInt32",
                                "asynInt32Average",
                                "asynFloat64",
                                "asynFloat64Average",
                                "asynInt64",
                                "IOC " "stats",
                                "IOC " "stats " "clusts",
                                "GPIB " "init/report",
                                "Sec " "Past " "Epoch",
                                "asyn " "ai " "stringParm",
                                "asyn " "ai " "HeidND261",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.DTYP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.STAT",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.SEVR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_new_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.NSTA",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_new_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.NSEV",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_disable_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.DISS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.INP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_raw_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -2147483648,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.RVAL",
                            "units": "",
                            "upper_ctrl_limit": 2147483647,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_differential",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Single-Ended", "Differential"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiDiff1",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_high",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiHOPR1",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_low",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiLOPR1",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_temperature_units",
                        {
                            "dtype": "integer",
                            "enum_strs": ("K", "C", "F"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiTempUnits1",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_resolution",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Default",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiResolution1",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_range",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "+= " "10V",
                                "+= 1V",
                                "+= " "0.1V",
                                "+= " "0.01V",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiRange1",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_voltmeter_mode",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Volts",
                                "Type " "B TC",
                                "Type " "C TC",
                                "Type " "E TC",
                                "Type " "J TC",
                                "Type " "K TC",
                                "Type " "N TC",
                                "Type " "R TC",
                                "Type " "S TC",
                                "Type " "T TC",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiMode1",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_gate",
                        {
                            "dtype": "integer",
                            "enum_strs": ("N", "Y"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.G3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_preset_count",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.PR3",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_frequency",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 3,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.FREQ",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset0.C",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_record_dark_time",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset_time.VAL",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "IpreKB_channel_advance_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Internal", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:ChannelAdvance",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_num_channels_to_use",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:NuseAll",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "IpreKB_max_channels",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:MaxChannels",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "IpreKB_channel_one_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Int. " "clock", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:Channel1Source",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "IpreKB_count_on_start",
                        {
                            "dtype": "integer",
                            "enum_strs": ("No", "Yes"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:CountOnStart",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "IpreKB_channel_advance_source": 1706288136.019154,
                "IpreKB_channel_one_source": 1706288136.019154,
                "IpreKB_count_on_start": 1712612472.005776,
                "IpreKB_description": 1712864329.37917,
                "IpreKB_frequency": 1712864329.37917,
                "IpreKB_gate": 1712864329.37917,
                "IpreKB_max_channels": 1706288136.002487,
                "IpreKB_num_channels_to_use": 1706288136.002487,
                "IpreKB_offset": 631152000.0,
                "IpreKB_preset_count": 1712864329.37917,
                "IpreKB_record_dark_time": 631152000.0,
                "IpreKB_voltmeter_alarm_severity": 1712864344.408019,
                "IpreKB_voltmeter_alarm_status": 1712864344.408019,
                "IpreKB_voltmeter_description": 1712864344.80803,
                "IpreKB_voltmeter_device_type": 1712864344.408019,
                "IpreKB_voltmeter_differential": 1712864344.9165897,
                "IpreKB_voltmeter_disable_alarm_severity": 1712864344.408019,
                "IpreKB_voltmeter_disable_value": 1712864344.408019,
                "IpreKB_voltmeter_forward_link": 1712864344.708012,
                "IpreKB_voltmeter_high": 631152000.0,
                "IpreKB_voltmeter_input_link": 1712864344.708012,
                "IpreKB_voltmeter_low": 631152000.0,
                "IpreKB_voltmeter_mode": 1712611706.861578,
                "IpreKB_voltmeter_new_alarm_severity": 1712864344.408019,
                "IpreKB_voltmeter_new_alarm_status": 1712864344.408019,
                "IpreKB_voltmeter_range": 1712611706.862166,
                "IpreKB_voltmeter_raw_value": 1712864344.408019,
                "IpreKB_voltmeter_resolution": 1712611706.863596,
                "IpreKB_voltmeter_scan_disable_input_link_value": 1712864344.408019,
                "IpreKB_voltmeter_scan_disable_value_input_link": 1712864344.708012,
                "IpreKB_voltmeter_scanning_rate": 1712864344.408019,
                "IpreKB_voltmeter_temperature_units": 1712611706.861578,
            },
        },
        "Ipreslit": {
            "data": {
                "Ipreslit_channel_advance_source": 1,
                "Ipreslit_channel_one_source": 1,
                "Ipreslit_count_on_start": 1,
                "Ipreslit_description": "Ipreslit",
                "Ipreslit_frequency": 10000000.0,
                "Ipreslit_gate": 0,
                "Ipreslit_max_channels": 8000,
                "Ipreslit_num_channels_to_use": 8000,
                "Ipreslit_offset": 0.0,
                "Ipreslit_preset_count": 0.0,
                "Ipreslit_record_dark_time": 0.0,
                "Ipreslit_voltmeter_alarm_severity": 0,
                "Ipreslit_voltmeter_alarm_status": 0,
                "Ipreslit_voltmeter_description": "Ipreslit",
                "Ipreslit_voltmeter_device_type": 8,
                "Ipreslit_voltmeter_differential": 0,
                "Ipreslit_voltmeter_disable_alarm_severity": 0,
                "Ipreslit_voltmeter_disable_value": 1,
                "Ipreslit_voltmeter_forward_link": "",
                "Ipreslit_voltmeter_high": 0.0,
                "Ipreslit_voltmeter_input_link": "@asyn(LJT7V_0 " "0)ANALOG_IN_VALUE",
                "Ipreslit_voltmeter_low": 0.0,
                "Ipreslit_voltmeter_mode": 0,
                "Ipreslit_voltmeter_new_alarm_severity": 0,
                "Ipreslit_voltmeter_new_alarm_status": 0,
                "Ipreslit_voltmeter_range": 0,
                "Ipreslit_voltmeter_raw_value": 0,
                "Ipreslit_voltmeter_resolution": 0,
                "Ipreslit_voltmeter_scan_disable_input_link_value": 0,
                "Ipreslit_voltmeter_scan_disable_value_input_link": "",
                "Ipreslit_voltmeter_scanning_rate": 9,
                "Ipreslit_voltmeter_temperature_units": 0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "Ipreslit_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.NM2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.DESC",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_scanning_rate",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Passive",
                                "Event",
                                "I/O " "Intr",
                                "10 " "second",
                                "5 " "second",
                                "2 " "second",
                                "1 " "second",
                                ".5 " "second",
                                ".2 " "second",
                                ".1 " "second",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.SCAN",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_disable_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.DISV",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_scan_disable_input_link_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.DISA",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_scan_disable_value_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.SDIS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_forward_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.FLNK",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_device_type",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Soft " "Channel",
                                "Raw " "Soft " "Channel",
                                "Async " "Soft " "Channel",
                                "Soft " "Timestamp",
                                "General " "Time",
                                "asynInt32",
                                "asynInt32Average",
                                "asynFloat64",
                                "asynFloat64Average",
                                "asynInt64",
                                "IOC " "stats",
                                "IOC " "stats " "clusts",
                                "GPIB " "init/report",
                                "Sec " "Past " "Epoch",
                                "asyn " "ai " "stringParm",
                                "asyn " "ai " "HeidND261",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.DTYP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.STAT",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.SEVR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_new_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.NSTA",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_new_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.NSEV",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_disable_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.DISS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.INP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_raw_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -2147483648,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.RVAL",
                            "units": "",
                            "upper_ctrl_limit": 2147483647,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_differential",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Single-Ended", "Differential"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiDiff0",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_high",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiHOPR0",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_low",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiLOPR0",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_temperature_units",
                        {
                            "dtype": "integer",
                            "enum_strs": ("K", "C", "F"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiTempUnits0",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_resolution",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Default",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiResolution0",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_range",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "+= " "10V",
                                "+= " "1V",
                                "+= " "0.1V",
                                "+= " "0.01V",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiRange0",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_voltmeter_mode",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Volts",
                                "Type " "B " "TC",
                                "Type " "C " "TC",
                                "Type " "E " "TC",
                                "Type " "J " "TC",
                                "Type " "K " "TC",
                                "Type " "N " "TC",
                                "Type " "R " "TC",
                                "Type " "S " "TC",
                                "Type " "T " "TC",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiMode0",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_gate",
                        {
                            "dtype": "integer",
                            "enum_strs": ("N", "Y"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.G2",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_preset_count",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.PR2",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_frequency",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 3,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.FREQ",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset0.B",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_record_dark_time",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset_time.VAL",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Ipreslit_channel_advance_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Internal", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:ChannelAdvance",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_num_channels_to_use",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:NuseAll",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "Ipreslit_max_channels",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:MaxChannels",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "Ipreslit_channel_one_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Int. " "clock", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:Channel1Source",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Ipreslit_count_on_start",
                        {
                            "dtype": "integer",
                            "enum_strs": ("No", "Yes"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:CountOnStart",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "Ipreslit_channel_advance_source": 1706288136.019154,
                "Ipreslit_channel_one_source": 1706288136.019154,
                "Ipreslit_count_on_start": 1712612472.005776,
                "Ipreslit_description": 1712864329.37917,
                "Ipreslit_frequency": 1712864329.37917,
                "Ipreslit_gate": 1712864329.37917,
                "Ipreslit_max_channels": 1706288136.002487,
                "Ipreslit_num_channels_to_use": 1706288136.002487,
                "Ipreslit_offset": 631152000.0,
                "Ipreslit_preset_count": 1712864329.37917,
                "Ipreslit_record_dark_time": 631152000.0,
                "Ipreslit_voltmeter_alarm_severity": 1712864344.408013,
                "Ipreslit_voltmeter_alarm_status": 1712864344.408013,
                "Ipreslit_voltmeter_description": 1712864344.508012,
                "Ipreslit_voltmeter_device_type": 1712864344.408013,
                "Ipreslit_voltmeter_differential": 1712864344.9160936,
                "Ipreslit_voltmeter_disable_alarm_severity": 1712864344.408013,
                "Ipreslit_voltmeter_disable_value": 1712864344.408013,
                "Ipreslit_voltmeter_forward_link": 1712864344.508012,
                "Ipreslit_voltmeter_high": 631152000.0,
                "Ipreslit_voltmeter_input_link": 1712864344.707998,
                "Ipreslit_voltmeter_low": 631152000.0,
                "Ipreslit_voltmeter_mode": 1712611706.860634,
                "Ipreslit_voltmeter_new_alarm_severity": 1712864344.408013,
                "Ipreslit_voltmeter_new_alarm_status": 1712864344.408013,
                "Ipreslit_voltmeter_range": 1712611706.861238,
                "Ipreslit_voltmeter_raw_value": 1712864344.408013,
                "Ipreslit_voltmeter_resolution": 1712611706.861572,
                "Ipreslit_voltmeter_scan_disable_input_link_value": 1712864344.408013,
                "Ipreslit_voltmeter_scan_disable_value_input_link": 1712864344.508012,
                "Ipreslit_voltmeter_scanning_rate": 1712864344.408013,
                "Ipreslit_voltmeter_temperature_units": 1712611706.860634,
            },
        },
        "Iref": {
            "data": {
                "Iref_channel_advance_source": 1,
                "Iref_channel_one_source": 1,
                "Iref_count_on_start": 1,
                "Iref_description": "Iref",
                "Iref_frequency": 10000000.0,
                "Iref_gate": 0,
                "Iref_max_channels": 8000,
                "Iref_num_channels_to_use": 8000,
                "Iref_offset": 0.0,
                "Iref_preset_count": 0.0,
                "Iref_record_dark_time": 0.0,
                "Iref_voltmeter_alarm_severity": 0,
                "Iref_voltmeter_alarm_status": 0,
                "Iref_voltmeter_description": "Iref",
                "Iref_voltmeter_device_type": 8,
                "Iref_voltmeter_differential": 0,
                "Iref_voltmeter_disable_alarm_severity": 0,
                "Iref_voltmeter_disable_value": 1,
                "Iref_voltmeter_forward_link": "",
                "Iref_voltmeter_high": 0.0,
                "Iref_voltmeter_input_link": "@asyn(LJT7V_0 " "4)ANALOG_IN_VALUE",
                "Iref_voltmeter_low": 0.0,
                "Iref_voltmeter_mode": 0,
                "Iref_voltmeter_new_alarm_severity": 0,
                "Iref_voltmeter_new_alarm_status": 0,
                "Iref_voltmeter_range": 0,
                "Iref_voltmeter_raw_value": 0,
                "Iref_voltmeter_resolution": 0,
                "Iref_voltmeter_scan_disable_input_link_value": 0,
                "Iref_voltmeter_scan_disable_value_input_link": "",
                "Iref_voltmeter_scanning_rate": 9,
                "Iref_voltmeter_temperature_units": 0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "Iref_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.NM6",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.DESC",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_scanning_rate",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Passive",
                                "Event",
                                "I/O " "Intr",
                                "10 " "second",
                                "5 " "second",
                                "2 " "second",
                                "1 " "second",
                                ".5 " "second",
                                ".2 " "second",
                                ".1 " "second",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.SCAN",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_disable_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.DISV",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "Iref_voltmeter_scan_disable_input_link_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.DISA",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "Iref_voltmeter_scan_disable_value_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.SDIS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_forward_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.FLNK",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_device_type",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Soft " "Channel",
                                "Raw " "Soft " "Channel",
                                "Async " "Soft " "Channel",
                                "Soft " "Timestamp",
                                "General " "Time",
                                "asynInt32",
                                "asynInt32Average",
                                "asynFloat64",
                                "asynFloat64Average",
                                "asynInt64",
                                "IOC " "stats",
                                "IOC " "stats " "clusts",
                                "GPIB " "init/report",
                                "Sec " "Past " "Epoch",
                                "asyn ai " "stringParm",
                                "asyn ai " "HeidND261",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.DTYP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.STAT",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.SEVR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_new_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.NSTA",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_new_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.NSEV",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_disable_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.DISS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.INP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_raw_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -2147483648,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.RVAL",
                            "units": "",
                            "upper_ctrl_limit": 2147483647,
                        },
                    ),
                    (
                        "Iref_voltmeter_differential",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Single-Ended", "Differential"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiDiff4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_high",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiHOPR4",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_voltmeter_low",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiLOPR4",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_voltmeter_temperature_units",
                        {
                            "dtype": "integer",
                            "enum_strs": ("K", "C", "F"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiTempUnits4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_resolution",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Default",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiResolution4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_range",
                        {
                            "dtype": "integer",
                            "enum_strs": ("+= 10V", "+= 1V", "+= 0.1V", "+= " "0.01V"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiRange4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_voltmeter_mode",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Volts",
                                "Type B " "TC",
                                "Type C " "TC",
                                "Type E " "TC",
                                "Type J " "TC",
                                "Type K " "TC",
                                "Type N " "TC",
                                "Type R " "TC",
                                "Type S " "TC",
                                "Type T " "TC",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiMode4",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_gate",
                        {
                            "dtype": "integer",
                            "enum_strs": ("N", "Y"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.G6",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_preset_count",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.PR6",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_frequency",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 3,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.FREQ",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset1.B",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_record_dark_time",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset_time.VAL",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "Iref_channel_advance_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Internal", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:ChannelAdvance",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_num_channels_to_use",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:NuseAll",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "Iref_max_channels",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:MaxChannels",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "Iref_channel_one_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Int. " "clock", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:Channel1Source",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "Iref_count_on_start",
                        {
                            "dtype": "integer",
                            "enum_strs": ("No", "Yes"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:CountOnStart",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "Iref_channel_advance_source": 1706288136.019154,
                "Iref_channel_one_source": 1706288136.019154,
                "Iref_count_on_start": 1712612472.005776,
                "Iref_description": 1712864329.37917,
                "Iref_frequency": 1712864329.37917,
                "Iref_gate": 1712864329.37917,
                "Iref_max_channels": 1706288136.002487,
                "Iref_num_channels_to_use": 1706288136.002487,
                "Iref_offset": 631152000.0,
                "Iref_preset_count": 1712864329.37917,
                "Iref_record_dark_time": 631152000.0,
                "Iref_voltmeter_alarm_severity": 1712864344.508031,
                "Iref_voltmeter_alarm_status": 1712864344.508031,
                "Iref_voltmeter_description": 1712864344.808051,
                "Iref_voltmeter_device_type": 1712864344.508031,
                "Iref_voltmeter_differential": 1712864344.9155679,
                "Iref_voltmeter_disable_alarm_severity": 1712864344.508031,
                "Iref_voltmeter_disable_value": 1712864344.508031,
                "Iref_voltmeter_forward_link": 1712864344.808051,
                "Iref_voltmeter_high": 631152000.0,
                "Iref_voltmeter_input_link": 1712864344.808051,
                "Iref_voltmeter_low": 631152000.0,
                "Iref_voltmeter_mode": 1712611706.864903,
                "Iref_voltmeter_new_alarm_severity": 1712864344.508031,
                "Iref_voltmeter_new_alarm_status": 1712864344.508031,
                "Iref_voltmeter_range": 1712611706.865332,
                "Iref_voltmeter_raw_value": 1712864344.508031,
                "Iref_voltmeter_resolution": 1712611706.865552,
                "Iref_voltmeter_scan_disable_input_link_value": 1712864344.508031,
                "Iref_voltmeter_scan_disable_value_input_link": 1712864344.808051,
                "Iref_voltmeter_scanning_rate": 1712864344.508031,
                "Iref_voltmeter_temperature_units": 1712611706.864904,
            },
        },
        "It": {
            "data": {
                "It_channel_advance_source": 1,
                "It_channel_one_source": 1,
                "It_count_on_start": 1,
                "It_description": "It",
                "It_frequency": 10000000.0,
                "It_gate": 0,
                "It_max_channels": 8000,
                "It_num_channels_to_use": 8000,
                "It_offset": 0.0,
                "It_preset_count": 0.0,
                "It_record_dark_time": 0.0,
                "It_voltmeter_alarm_severity": 0,
                "It_voltmeter_alarm_status": 0,
                "It_voltmeter_description": "It",
                "It_voltmeter_device_type": 8,
                "It_voltmeter_differential": 0,
                "It_voltmeter_disable_alarm_severity": 0,
                "It_voltmeter_disable_value": 1,
                "It_voltmeter_forward_link": "",
                "It_voltmeter_high": 0.0,
                "It_voltmeter_input_link": "@asyn(LJT7V_0 " "3)ANALOG_IN_VALUE",
                "It_voltmeter_low": 0.0,
                "It_voltmeter_mode": 0,
                "It_voltmeter_new_alarm_severity": 0,
                "It_voltmeter_new_alarm_status": 0,
                "It_voltmeter_range": 0,
                "It_voltmeter_raw_value": 0,
                "It_voltmeter_resolution": 0,
                "It_voltmeter_scan_disable_input_link_value": 0,
                "It_voltmeter_scan_disable_value_input_link": "",
                "It_voltmeter_scanning_rate": 9,
                "It_voltmeter_temperature_units": 0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "It_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.NM5",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_description",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.DESC",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_scanning_rate",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Passive",
                                "Event",
                                "I/O Intr",
                                "10 second",
                                "5 second",
                                "2 second",
                                "1 second",
                                ".5 second",
                                ".2 second",
                                ".1 " "second",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.SCAN",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_disable_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.DISV",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "It_voltmeter_scan_disable_input_link_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -32768,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.DISA",
                            "units": "",
                            "upper_ctrl_limit": 32767,
                        },
                    ),
                    (
                        "It_voltmeter_scan_disable_value_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.SDIS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_forward_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.FLNK",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_device_type",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Soft " "Channel",
                                "Raw Soft " "Channel",
                                "Async " "Soft " "Channel",
                                "Soft " "Timestamp",
                                "General " "Time",
                                "asynInt32",
                                "asynInt32Average",
                                "asynFloat64",
                                "asynFloat64Average",
                                "asynInt64",
                                "IOC stats",
                                "IOC stats " "clusts",
                                "GPIB " "init/report",
                                "Sec Past " "Epoch",
                                "asyn ai " "stringParm",
                                "asyn ai " "HeidND261",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.DTYP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.STAT",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.SEVR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_new_alarm_status",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "NO_ALARM",
                                "READ",
                                "WRITE",
                                "HIHI",
                                "HIGH",
                                "LOLO",
                                "LOW",
                                "STATE",
                                "COS",
                                "COMM",
                                "TIMEOUT",
                                "HWLIMIT",
                                "CALC",
                                "SCAN",
                                "LINK",
                                "SOFT",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.NSTA",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_new_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.NSEV",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_disable_alarm_severity",
                        {
                            "dtype": "integer",
                            "enum_strs": ("NO_ALARM", "MINOR", "MAJOR", "INVALID"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.DISS",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_input_link",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.INP",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_raw_value",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": -2147483648,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.RVAL",
                            "units": "",
                            "upper_ctrl_limit": 2147483647,
                        },
                    ),
                    (
                        "It_voltmeter_differential",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Single-Ended", "Differential"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiDiff3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_high",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiHOPR3",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_voltmeter_low",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 4,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiLOPR3",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_voltmeter_temperature_units",
                        {
                            "dtype": "integer",
                            "enum_strs": ("K", "C", "F"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiTempUnits3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_resolution",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Default",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiResolution3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_range",
                        {
                            "dtype": "integer",
                            "enum_strs": ("+= 10V", "+= 1V", "+= 0.1V", "+= 0.01V"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiRange3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_voltmeter_mode",
                        {
                            "dtype": "integer",
                            "enum_strs": (
                                "Volts",
                                "Type B TC",
                                "Type C TC",
                                "Type E TC",
                                "Type J TC",
                                "Type K TC",
                                "Type N TC",
                                "Type R TC",
                                "Type S TC",
                                "Type T " "TC",
                            ),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:LJT7Voltmeter_0:AiMode3",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_gate",
                        {
                            "dtype": "integer",
                            "enum_strs": ("N", "Y"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.G5",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_preset_count",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.PR5",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_frequency",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 3,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1.FREQ",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset1.A",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_record_dark_time",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.0,
                            "precision": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:scaler1_offset_time.VAL",
                            "units": "",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "It_channel_advance_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Internal", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:ChannelAdvance",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_num_channels_to_use",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:NuseAll",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "It_max_channels",
                        {
                            "dtype": "integer",
                            "lower_ctrl_limit": 0,
                            "shape": [],
                            "source": "PV:25idcVME:3820:MaxChannels",
                            "units": "",
                            "upper_ctrl_limit": 0,
                        },
                    ),
                    (
                        "It_channel_one_source",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Int. " "clock", "External"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:Channel1Source",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "It_count_on_start",
                        {
                            "dtype": "integer",
                            "enum_strs": ("No", "Yes"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idcVME:3820:CountOnStart",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "It_channel_advance_source": 1706288136.019154,
                "It_channel_one_source": 1706288136.019154,
                "It_count_on_start": 1712612472.005776,
                "It_description": 1712864329.37917,
                "It_frequency": 1712864329.37917,
                "It_gate": 1712864329.37917,
                "It_max_channels": 1706288136.002487,
                "It_num_channels_to_use": 1706288136.002487,
                "It_offset": 631152000.0,
                "It_preset_count": 1712864329.37917,
                "It_record_dark_time": 631152000.0,
                "It_voltmeter_alarm_severity": 1712864344.408026,
                "It_voltmeter_alarm_status": 1712864344.408026,
                "It_voltmeter_description": 1712864344.808045,
                "It_voltmeter_device_type": 1712864344.408026,
                "It_voltmeter_differential": 1712864344.8897717,
                "It_voltmeter_disable_alarm_severity": 1712864344.408026,
                "It_voltmeter_disable_value": 1712864344.408026,
                "It_voltmeter_forward_link": 1712864344.808045,
                "It_voltmeter_high": 631152000.0,
                "It_voltmeter_input_link": 1712864344.808045,
                "It_voltmeter_low": 631152000.0,
                "It_voltmeter_mode": 1712611706.864254,
                "It_voltmeter_new_alarm_severity": 1712864344.408026,
                "It_voltmeter_new_alarm_status": 1712864344.408026,
                "It_voltmeter_range": 1712611706.864677,
                "It_voltmeter_raw_value": 1712864344.408026,
                "It_voltmeter_resolution": 1712611706.864903,
                "It_voltmeter_scan_disable_input_link_value": 1712864344.408026,
                "It_voltmeter_scan_disable_value_input_link": 1712864344.808045,
                "It_voltmeter_scanning_rate": 1712864344.408026,
                "It_voltmeter_temperature_units": 1712611706.864255,
            },
        },
        "sim motor 1": {
            "data": {
                "sim motor 1_acceleration": 0.2,
                "sim motor 1_motor_egu": "degrees",
                "sim motor 1_user_offset": 0.0,
                "sim motor 1_user_offset_dir": 0,
                "sim motor 1_velocity": 1.0,
            },
            "data_keys": OrderedDict(
                [
                    (
                        "sim motor " "1_user_offset",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": -1e300,
                            "precision": 5,
                            "shape": [],
                            "source": "PV:25idc:simMotor:m1.OFF",
                            "units": "degrees",
                            "upper_ctrl_limit": 1e300,
                        },
                    ),
                    (
                        "sim motor " "1_user_offset_dir",
                        {
                            "dtype": "integer",
                            "enum_strs": ("Pos", "Neg"),
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:simMotor:m1.DIR",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                    (
                        "sim motor " "1_velocity",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": 0.1,
                            "precision": 5,
                            "shape": [],
                            "source": "PV:25idc:simMotor:m1.VELO",
                            "units": "degrees",
                            "upper_ctrl_limit": 0.0,
                        },
                    ),
                    (
                        "sim motor " "1_acceleration",
                        {
                            "dtype": "number",
                            "lower_ctrl_limit": -1e300,
                            "precision": 5,
                            "shape": [],
                            "source": "PV:25idc:simMotor:m1.ACCL",
                            "units": "sec",
                            "upper_ctrl_limit": 1e300,
                        },
                    ),
                    (
                        "sim motor " "1_motor_egu",
                        {
                            "dtype": "string",
                            "lower_ctrl_limit": None,
                            "shape": [],
                            "source": "PV:25idc:simMotor:m1.EGU",
                            "units": None,
                            "upper_ctrl_limit": None,
                        },
                    ),
                ]
            ),
            "timestamps": {
                "sim motor 1_acceleration": 1712864329.368713,
                "sim motor 1_motor_egu": 1712864329.368713,
                "sim motor 1_user_offset": 1712864329.368713,
                "sim motor 1_user_offset_dir": 1712864329.368713,
                "sim motor 1_velocity": 1712864329.368713,
            },
        },
    },
    "data_keys": {
        "I0_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.S4",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "I0_exposure_time": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 3,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.TP",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "I0_net_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1_netA.D",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "I0_voltmeter_amps": {
            "derived_from": "I0_voltmeter_volts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 4,
            "shape": [],
            "source": "SIM:I0_voltmeter_amps",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "I0_voltmeter_enable": {
            "dtype": "integer",
            "enum_strs": ("Disable", "Enable"),
            "lower_ctrl_limit": None,
            "object_name": "I0",
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:AiEnable2",
            "units": None,
            "upper_ctrl_limit": None,
        },
        "I0_voltmeter_volts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 4,
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:Ai2.VAL",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "I0_volts": {
            "derived_from": "I0_counts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "I0",
            "precision": 0,
            "shape": [],
            "source": "SIM:I0_volts",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.S3",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_exposure_time": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 3,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.TP",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_net_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1_netA.C",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_voltmeter_amps": {
            "derived_from": "IpreKB_voltmeter_volts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 4,
            "shape": [],
            "source": "SIM:IpreKB_voltmeter_amps",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_voltmeter_enable": {
            "dtype": "integer",
            "enum_strs": ("Disable", "Enable"),
            "lower_ctrl_limit": None,
            "object_name": "IpreKB",
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:AiEnable1",
            "units": None,
            "upper_ctrl_limit": None,
        },
        "IpreKB_voltmeter_volts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 4,
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:Ai1.VAL",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "IpreKB_volts": {
            "derived_from": "IpreKB_counts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "IpreKB",
            "precision": 0,
            "shape": [],
            "source": "SIM:IpreKB_volts",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.S2",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_exposure_time": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 3,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.TP",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_net_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1_netA.B",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_voltmeter_amps": {
            "derived_from": "Ipreslit_voltmeter_volts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 4,
            "shape": [],
            "source": "SIM:Ipreslit_voltmeter_amps",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_voltmeter_enable": {
            "dtype": "integer",
            "enum_strs": ("Disable", "Enable"),
            "lower_ctrl_limit": None,
            "object_name": "Ipreslit",
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:AiEnable0",
            "units": None,
            "upper_ctrl_limit": None,
        },
        "Ipreslit_voltmeter_volts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 4,
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:Ai0.VAL",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Ipreslit_volts": {
            "derived_from": "Ipreslit_counts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Ipreslit",
            "precision": 0,
            "shape": [],
            "source": "SIM:Ipreslit_volts",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.S6",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_exposure_time": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 3,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.TP",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_net_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1_netA.F",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_voltmeter_amps": {
            "derived_from": "Iref_voltmeter_volts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 4,
            "shape": [],
            "source": "SIM:Iref_voltmeter_amps",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_voltmeter_enable": {
            "dtype": "integer",
            "enum_strs": ("Disable", "Enable"),
            "lower_ctrl_limit": None,
            "object_name": "Iref",
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:AiEnable4",
            "units": None,
            "upper_ctrl_limit": None,
        },
        "Iref_voltmeter_volts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 4,
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:Ai4.VAL",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "Iref_volts": {
            "derived_from": "Iref_counts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "Iref",
            "precision": 0,
            "shape": [],
            "source": "SIM:Iref_volts",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.S5",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_exposure_time": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 3,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1.TP",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_net_counts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 0,
            "shape": [],
            "source": "PV:25idcVME:3820:scaler1_netA.E",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_voltmeter_amps": {
            "derived_from": "It_voltmeter_volts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 4,
            "shape": [],
            "source": "SIM:It_voltmeter_amps",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_voltmeter_enable": {
            "dtype": "integer",
            "enum_strs": ("Disable", "Enable"),
            "lower_ctrl_limit": None,
            "object_name": "It",
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:AiEnable3",
            "units": None,
            "upper_ctrl_limit": None,
        },
        "It_voltmeter_volts": {
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 4,
            "shape": [],
            "source": "PV:25idc:LJT7Voltmeter_0:Ai3.VAL",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "It_volts": {
            "derived_from": "It_counts",
            "dtype": "number",
            "lower_ctrl_limit": 0.0,
            "object_name": "It",
            "precision": 0,
            "shape": [],
            "source": "SIM:It_volts",
            "units": "",
            "upper_ctrl_limit": 0.0,
        },
        "sim motor 1": {
            "dtype": "number",
            "lower_ctrl_limit": -32000.0,
            "object_name": "sim motor 1",
            "precision": 5,
            "shape": [],
            "source": "PV:25idc:simMotor:m1.RBV",
            "units": "degrees",
            "upper_ctrl_limit": 32000.0,
        },
        "sim motor 1_user_setpoint": {
            "dtype": "number",
            "lower_ctrl_limit": -32000.0,
            "object_name": "sim motor 1",
            "precision": 5,
            "shape": [],
            "source": "PV:25idc:simMotor:m1.VAL",
            "units": "degrees",
            "upper_ctrl_limit": 32000.0,
        },
    },
    "hints": {
        "I0": {"fields": ["I0_net_counts"]},
        "IpreKB": {"fields": ["IpreKB_net_counts"]},
        "Ipreslit": {"fields": ["Ipreslit_net_counts"]},
        "Iref": {"fields": ["Iref_net_counts"]},
        "It": {"fields": ["It_net_counts"]},
        "sim motor 1": {"fields": ["sim motor 1"]},
    },
    "name": "primary",
    "object_keys": {
        "I0": [
            "I0_voltmeter_enable",
            "I0_voltmeter_amps",
            "I0_voltmeter_volts",
            "I0_volts",
            "I0_counts",
            "I0_net_counts",
            "I0_exposure_time",
        ],
        "IpreKB": [
            "IpreKB_voltmeter_enable",
            "IpreKB_voltmeter_amps",
            "IpreKB_voltmeter_volts",
            "IpreKB_volts",
            "IpreKB_counts",
            "IpreKB_net_counts",
            "IpreKB_exposure_time",
        ],
        "Ipreslit": [
            "Ipreslit_voltmeter_enable",
            "Ipreslit_voltmeter_amps",
            "Ipreslit_voltmeter_volts",
            "Ipreslit_volts",
            "Ipreslit_counts",
            "Ipreslit_net_counts",
            "Ipreslit_exposure_time",
        ],
        "Iref": [
            "Iref_voltmeter_enable",
            "Iref_voltmeter_amps",
            "Iref_voltmeter_volts",
            "Iref_volts",
            "Iref_counts",
            "Iref_net_counts",
            "Iref_exposure_time",
        ],
        "It": [
            "It_voltmeter_enable",
            "It_voltmeter_amps",
            "It_voltmeter_volts",
            "It_volts",
            "It_counts",
            "It_net_counts",
            "It_exposure_time",
        ],
        "sim motor 1": ["sim motor 1", "sim motor 1_user_setpoint"],
    },
    "run_start": "6974290f-fe3f-4535-bb8c-c29c915f88aa",
    "time": 1712865522.9266968,
    "uid": "7ed5b8c5-045c-41fa-b79c-50fbcbe777e5",
}


@pytest.fixture()
def stringio():
    yield StringIO()


@pytest.fixture()
def file_path(tmp_path):
    fp = tmp_path / "sample_file.txt"
    try:
        yield fp
    finally:
        fp.unlink()


@pytest.fixture()
def writer(stringio):
    yield XDIWriter(stringio)


def test_opens_file(file_path):
    # Pass in a string and it should hold the path until the start document is found
    fp = file_path
    writer = XDIWriter(fp)
    assert writer.fp == fp
    assert not fp.exists()
    # Run the writer
    writer("start", {"edge": "Ni_K"})
    # Check that a file was created
    assert fp.exists()


def test_uses_open_file(stringio):
    # Pass in a string and it should hold the path until the start document is found
    writer = XDIWriter(stringio)
    assert writer.fd is stringio


def test_read_only_file(file_path):
    # Check that it raises an exception if an open file has no write intent
    # Put some content in the temporary file
    with open(file_path, mode="w") as fd:
        fd.write("Hello, spam!")
    # Check that the writer raises an exception when the file is open read-only
    with open(file_path, mode="r") as fd:
        with pytest.raises(exceptions.FileNotWritable):
            XDIWriter(fd)


def test_required_headers(writer):
    writer("start", start_doc)
    writer("event", event_doc)  # Header gets written on first event
    # Check that required headers were added to the XDI file
    writer.fd.seek(0)
    xdi_output = writer.fd.read()
    assert "# XDI/1.0 bluesky/1.8.3 ophyd/1.6.4" in xdi_output
    assert "# Column.1: energy" in xdi_output
    assert "# Element.symbol: Ni" in xdi_output
    assert "# Element.edge: K" in xdi_output
    # assert "# Mono.d_spacing: 3" in xdi_output  # Not implemented yet
    assert "# -------------" in xdi_output


@time_machine.travel(fake_time)
def test_optional_headers(writer):
    os.environ["TZ"] = "America/New_York"
    time.tzset()
    writer("start", start_doc)
    writer("event", event_doc)
    # Check that required headers were added to the XDI file
    writer.fd.seek(0)
    xdi_output = writer.fd.read()
    expected_metadata = {
        "Facility.name": "Advanced Photon Source",
        "Facility.xray_source": "insertion device",
        "Beamline.name": "20-ID-C",
        "Beamline.pv_prefix": "20id:",
        "Scan.start_time": "2022-08-19 19:10:51-0400",
        "Column.5": "time",
        "uid": "671c3c48-f014-421d-b3e0-57991b6745f6",
    }
    for key, val in expected_metadata.items():
        assert f"# {key.lower()}: {val.lower()}\n" in xdi_output.lower()


@time_machine.travel(fake_time)
def test_file_path_formatting(tmp_path):
    """Check that "{date}_{user}.xdi" formatting works in the filename."""
    writer = XDIWriter(tmp_path / "{year}{month}{day}_{short_uid}_{sample_name}.xdi")
    writer.start(start_doc)
    assert str(writer.fp) == str(tmp_path / "20220819_671c3c48_nickel-oxide.xdi")


@time_machine.travel(fake_time)
def test_file_path_reentry(tmp_path):
    """Check that "{date}_{user}.xdi" formatting can be used multiple times."""
    # Start the writer once with basic arguments
    writer = XDIWriter(tmp_path / "{year}{month}{day}_{short_uid}_{sample_name}.xdi")
    writer.start(start_doc)
    target_path = str(tmp_path / "20220819_671c3c48_nickel-oxide.xdi")
    assert str(writer.fp) == target_path
    assert writer.fd.name == target_path
    # Check that additional start docs don't create new files
    writer.start(start_doc)
    # Start the writer again with a second set of arguments
    new_start_doc = ChainMap(
        {
            "sample_name": "manganese oxide",
            "uid": "a6842eaa-6dd3-4666-83a0-1829cd687556",
        },
        start_doc,
    )
    writer.start(new_start_doc)
    target_path = str(tmp_path / "20220819_a6842eaa_manganese-oxide.xdi")
    assert str(writer.fp) == target_path
    assert writer.fd.name == target_path


@time_machine.travel(fake_time)
def test_manager_path(tmp_path, beamline_manager):
    """Check that "{manager_path}.xdi" formatting works in the filename."""
    # Set up a full path on the beamline manager
    beamline_manager.local_storage.full_path._readback = str(tmp_path) + "/"
    # Create the XDI writer object
    writer = XDIWriter(
        "{manager_path}/{year}{month}{day}_{short_uid}_{sample_name}.xdi"
    )
    writer.start(start_doc)
    assert str(writer.fp) == f"{tmp_path}/20220819_671c3c48_nickel-oxide.xdi"


def test_file_path_formatting_bad_key():
    """Check that "{date}_{user}.xdi" raises exception if placeholder is invalid."""
    writer = XDIWriter("{year}{month}{day}_{spam}_{sample_name}.xdi")
    with pytest.raises(exceptions.XDIFilenameKeyNotFound):
        writer.start(start_doc)


def test_data(writer):
    """Check that the TSV data section is present and correct."""
    writer.start(start_doc)
    writer("event", event_doc)
    # Verify the data were written properly
    writer.fd.seek(0)
    xdi_output = writer.fd.read()
    assert "8330" in xdi_output
    assert "1660186828.0055554" in xdi_output


def test_with_plan(stringio, sim_registry, event_loop, beamline_manager, tmp_path):
    beamline_manager.local_storage.full_path._readback = str(tmp_path) + "/"
    I0 = SynGauss(
        "I0",
        motor,
        "motor",
        center=-0.5,
        Imax=1,
        sigma=1,
        labels={"detectors"},
    )
    It = SynGauss(
        "It",
        motor,
        "motor",
        center=-0.5,
        Imax=1,
        sigma=1,
        labels={"detectors"},
    )
    energy_motor = SynAxis(name="energy", labels={"motors", "energies"})
    exposure = SynAxis(name="exposure", labels={"motors", "exposures"})
    writer = XDIWriter(stringio)
    RE = RunEngine()
    energy_plan = energy_scan(
        np.arange(8300.0, 8400.0, 10),
        detectors=[I0, It],
        E0="Ni_K",
        energy_positioners=[energy_motor],
        time_positioners=[exposure],
        md=dict(sample_name="NiO_rock_salt"),
    )
    RE(energy_plan, writer)


# -----------------------------------------------------------------------------
# :author:    Mark Wolfman
# :email:     wolfman@anl.gov
# :copyright: Copyright  2023, UChicago Argonne, LLC
#
# Distributed under the terms of the 3-Clause BSD License
#
# The full license is in the file LICENSE, distributed with this software.
#
# DISCLAIMER
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
# A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
# HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
# SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# -----------------------------------------------------------------------------
